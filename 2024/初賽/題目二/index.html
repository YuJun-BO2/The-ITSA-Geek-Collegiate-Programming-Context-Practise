<html>

<head>
    <meta charset="UTF-8">
    <title>圖書管理系統</title>
    <link rel="stylesheet" href="index.css">
    <script src="jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function () {
            if (window.jQuery) {
                console.log('jQuery 已載入成功！');
            } else {
                console.log('jQuery 載入失敗！');
            }

            let books = []; // 儲存書籍

            // 找出下一個可用的 ID
            function findnextId() {
                let nextId = 1;
                if (books.length > 0) {
                    for (let i = 0; i < books.length; i++) {
                        if (nextId == books[i].id) {
                            nextId++;
                        } else {
                            return nextId;
                        }
                    }
                }
                return nextId;
            }

            // 添加或更新書籍
            $('form').on('submit', function (e) {
                e.preventDefault();
                if ($('input[name="id"]').val() === "") {
                    $('input[name="id"]').val(findnextId());

                    const book = {
                        id: $('input[name="id"]').val(),
                        title: $('input[name="title"]').val(),
                        author: $('input[name="author"]').val(),
                        year: $('input[name="year"]').val()
                    };

                    // 清空輸入欄位
                    $('input[name="id"]').val("");
                    $('input[name="title"]').val("");
                    $('input[name="author"]').val("");
                    $('input[name="year"]').val("");

                    books.push(book); // 加入陣列
                    console.log(books); // 檢查結果
                    
                    sortBooks();
                    displayBooks();
                }
                else if ($('input[name="id"]').val() !== "") {
                    const id = $('input[name="id"]').val();
                    const book = books.find(b => b.id === id);
                    if (book) {
                        $('input[name="title"]').val(book.title);
                        $('input[name="author"]').val(book.author);
                        $('input[name="year"]').val(book.year);
                    }
                }
            });

            // 更新Book list
            function displayBooks() {
                const tableBody = $('table tbody');
                tableBody.empty(); // 清空現有的表格內容
                books.forEach(book => {
                    const row = `<tr>
                        <td>${book.id}</td>
                        <td>${book.title}</td>
                        <td>${book.author}</td>
                        <td>${book.year}</td>
                        <td><button class="delete-btn" data-id="${book.id}">刪除</button></td>
                        <td><button class="update-btn" data-id="${book.id}">更新</button></td>
                    </tr>`;
                    tableBody.append(row);
                });
            };

            // 刪除書籍
            $(document).on('click', '.delete-btn', function () {
                const id = String($(this).data('id'));
                books = books.filter(b => b.id !== id); // 移除指定 ID 的書籍
                displayBooks(); // 更新顯示
            });

            // Sort books by id
            function sortBooks() {
                books.sort((a, b) => a.id - b.id);
            }
        });
    </script>
</head>

<body>
    <h1>圖書管理系統</h1>
    <h2>添加圖書</h2>
    <form>
        <input type="hidden" name="id" value="">
        書名: <br><input type="text" name="title"><br>
        作者: <br><input type="text" name="author"><br>
        出版年份: <br><input type="text" name="year"><br>
        <br><input type="submit" value="添加圖書">
    </form>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>書名</th>
                <th>作者</th>
                <th>出版年份</th>
                <th>刪除</th>
                <th>更新</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</body>